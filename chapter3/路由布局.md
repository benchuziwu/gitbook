# è·¯ç”±å¸ƒå±€

ejté¡¹ç›®é‡‡ç”¨ui-routerè¿›è¡Œé¡µé¢è·¯ç”±å¸ƒå±€ï¼Œ

Ui-routerçš„å¥½å¤„åœ¨äºå¯ä»¥åµŒå¥—è·¯ç”±ã€‚

åœ¨indexé¡µé¢æœ‰ä¸ªæ ¹è·¯ç”±<div ui-view="root"></div>,é¡µé¢å†…å®¹ç”±æ­¤å¼€å§‹åµŒå…¥ï¼Œ

é»˜è®¤è·¯ç”±æ˜¯å®šå‘è‡³loginé¡µé¢ï¼Œè¯¥è·¯ç”±åœ¨é¡¹ç›®ä¸­æ˜¯è¿™æ ·å®šä¹‰çš„

é…ç½®æ–‡ä»¶ï¼šhttp.config.js

```javascript
(function() {
    'use strict';
    angular
        .module('ejt1GatewayApp')
        .config(httpConfig);
    httpConfig.$inject = ['$urlRouterProvider', '$httpProvider', 'httpRequestInterceptorCacheBusterProvider', '$urlMatcherFactoryProvider'];
    function httpConfig($urlRouterProvider, $httpProvider, httpRequestInterceptorCacheBusterProvider, $urlMatcherFactoryProvider) {        httpRequestInterceptorCacheBusterProvider.setMatchlist([/.*api.*/, /.*protected.*/], true);

        $urlRouterProvider.otherwise('/login'); $httpProvider.interceptors.push('errorHandlerInterceptor');
$httpProvider.interceptors.push('authExpiredInterceptor');
$httpProvider.interceptors.push('authInterceptor');
$httpProvider.interceptors.push('notificationInterceptor');
$httpProvider.interceptors.push('loadingInterceptor');
$urlMatcherFactoryProvider.type('boolean', {
            name : 'boolean',
            decode: function(val) { return val === true || val === 'true'; },
            encode: function(val) { return val ? 1 : 0; },
            equals: function(a, b) { return this.is(a) && a === b; },
            is: function(val) { return [true,false,0,1].indexOf(val) >= 0; },
            pattern: /bool|true|0|1/
        });
    }
})();

```

###### è§£é‡Šï¼š

```
$urlRouterProvider.otherwise
å¯ä»¥åœ¨è·¯å¾„æ²¡æœ‰åŒ¹é…çš„è·¯ç”±çš„æ—¶å€™ï¼Œè·³è½¬è‡³ä¸€ä¸ªé»˜è®¤çš„è·¯å¾„
$urlRouterProvider.otherwise('/login')
$urlRouterProviderè´Ÿè´£ç›‘å¬$location,å½“$locationå˜åŒ–çš„æ—¶å€™ï¼Œ$urlRouterProviderå¼€å§‹åœ¨ä¸€ä¸ªè§„åˆ™çš„åˆ—è¡¨ä¸­ä¸€ä¸ªä¸ªçš„æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„å€¼ã€‚$urlRouterProviderç”¨äºåœ¨åç«¯æŒ‡å®šurlçš„çŠ¶æ€é…ç½®ã€‚æ‰€æœ‰çš„urlè¢«ç¼–è¯‘æˆUrlMatcherå¯¹è±¡ã€‚
ä¾èµ–ï¼š $urlMatcherFactoryProvider   $locationProvider
```



è·¯ç”±é…ç½®æ–‡ä»¶

```
.state('login', {
  url: '/login',
  /* @å‰é¢ä¸ºç©ºè¡¨ç¤ºæœªå‘½åçš„ ui-viewï¼Œ@ åé¢ä¸ºç©ºè¡¨ç¤ºç›¸å¯¹äºæ ¹æ¨¡æ¿ */
  views: {
    'root@': {
      templateUrl: 'app/components/login/login.html',
      controller: 'LoginController',
      controllerAs: 'vm'
    }
  },
  /* ä½¿ç”¨ resolve åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å‡†å¤‡ä¸€ç»„ç”¨æ¥æ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­çš„ä¾èµ–å¯¹è±¡ */
  resolve: {
    loadPlugin: function ($ocLazyLoad) {
      return $ocLazyLoad.load([{
        serie: true,
        files: ['app/components/login/login.css','plugins/gt.js', 'app/jiyan/geetestRegister.service.js',
          'app/jiyan/geetestValidate.service.js', 'app/services/auth/checkUser.service.js',
          'app/services/auth/checkPhone.service.js', 'plugins/sha.js',
          'app/directives/jiyan.directive.js']
      }]);
    },

    translatePartialLoader: ['$translate', '$translatePartialLoader', function ($translate, $translatePartialLoader) {
      $translatePartialLoader.addPart('ejtlogin');
      return $translate.refresh();
    }]
  }
})
```

###### è§£é‡Š

```
state(name,stateConfig);
æ³¨å†Œä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ç»™å®šå…¶é…ç½®ã€‚
name:çŠ¶æ€çš„åç§°ã€‚
stateConfig:çŠ¶æ€é…ç½®çš„å¯¹è±¡ï¼Œé…ç½®å…·æœ‰ä»¥ä¸‹å„é¡¹å±æ€§:
template:string/function,htmlæ¨¡ç‰ˆå­—ç¬¦ä¸²ï¼Œæˆ–è€…ä¸€ä¸ªè¿”å›htmlæ¨¡ç‰ˆå­—ç¬¦ä¸²çš„å‡½æ•°
templateUrl:string/funtion,æ¨¡ç‰ˆè·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…è¿”å›æ¨¡ç‰ˆè·¯å¾„å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œ
templateProvider:functionï¼Œè¿”å›htmlæ¨¡æ¿å­—ç¬¦ä¸²æˆ–æ¨¡æ¿è·¯å¾„çš„æœåŠ¡ã€‚
controller:string/function,æ–°æ³¨å†Œä¸€ä¸ªæ§åˆ¶å™¨å‡½æ•°æˆ–è€…ä¸€ä¸ªå·²æ³¨å†Œçš„æ§åˆ¶å™¨çš„åç§°å­—ç¬¦ä¸²ã€‚
controllerProviderï¼šfunctionï¼Œè¿”å›æ§åˆ¶å™¨æˆ–è€…æ§åˆ¶å™¨åç§°çš„æœåŠ¡
controllerAsï¼šstringï¼Œæ§åˆ¶å™¨åˆ«åã€‚
parent:string/object,æ‰‹åŠ¨æŒ‡å®šè¯¥çŠ¶æ€çš„çˆ¶çº§ã€‚
resolve:object,å°†ä¼šè¢«æ³¨å…¥controllerå»æ‰§è¡Œçš„å‡½æ•° ï¼Œ<string,function>å½¢å¼ã€‚ï¼ˆejté¡¹ç›®ä¸­ç¿»è¯‘jsonçš„åŠ è½½ï¼Œæ‡’åŠ è½½æ–‡ä»¶å‡½æ•°éƒ½æ˜¯é‡‡ç”¨resolveæ–¹å¼æ³¨å…¥ï¼Œå¦ä¸€ç§åº”ç”¨æ˜¯æ¯”å¦‚ä¸›åˆ—è¡¨é¡µè¿›å…¥ç¼–è¾‘å¼¹æ¡†é¡µï¼Œéœ€è¦è·å–è¯¥æ¡æ•°æ®çš„è¯¦æƒ…ï¼Œå¯ä»¥è¿™æ ·å†™                        resolve:{
   entity: ['User', function(User) {
   return User.get({login : $stateParams.login});
    }]
 }
url:string,å½“å‰çŠ¶æ€çš„å¯¹åº”urlã€‚
views:object,è§†å›¾å±•ç¤ºçš„é…ç½®ï¼Œ<string,object>å½¢å¼ã€‚
abstract:boolean,ä¸€ä¸ªæ°¸è¿œä¸ä¼šè¢«æ¿€æ´»çš„æŠ½è±¡çš„çŠ¶æ€ï¼Œä½†å¯ä»¥ç»™å…¶å­çº§æä¾›ç‰¹æ€§çš„ç»§æ‰¿ã€‚é»˜è®¤æ˜¯trueã€‚
onEnter:function,å½“è¿›å…¥ä¸€ä¸ªçŠ¶æ€åçš„å›è°ƒå‡½æ•°ã€‚ï¼ˆåœ¨ejté¡¹ç›®ä¸­å¾ˆå¤šçš„æ¨¡æ€å±‚æ‰“å¼€æ–¹å¼é‡‡ç”¨è¿™ç§å†™æ³•ï¼Œï¼‰
onExitï¼šfunctionï¼Œå½“é€€å‡ºä¸€ä¸ªçŠ¶æ€åçš„å›è°ƒå‡½æ•°ã€‚
dataï¼šobjectï¼Œä»»æ„å¯¹è±¡æ•°æ®ï¼Œç”¨äºè‡ªå®šä¹‰é…ç½®ã€‚ç»§æ‰¿çˆ¶çº§çŠ¶æ€çš„dataå±æ€§ã€‚æ¢å¥è¯è¯´ï¼Œé€šè¿‡åŸå‹ç»§æ‰¿å¯ä»¥è¾¾åˆ°æ·»åŠ ä¸€ä¸ªdataæ•°æ®ä»è€Œæ•´ä¸ªæ ‘ç»“æ„éƒ½èƒ½è·å–åˆ°ã€‚
paramsï¼šurlé‡Œçš„å‚æ•°å€¼ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°é¡µé¢é—´çš„å‚æ•°ä¼ é€’ã€‚
```

ejté¡¹ç›®ä¸­login.html,quicklogin.html,register.html,password.htmléƒ½æ˜¯é‡‡ç”¨root@çš„æ–¹å¼åµŒå…¥é¡µé¢ï¼Œå½“ç™»å½•æˆåŠŸåè¿›å…¥ç³»ç»Ÿï¼Œé¡¶éƒ¨å¯¼èˆªæ å’Œä¾§è¾¹æ å†…å®¹åŸºæœ¬ä¸å˜ï¼Œå› æ­¤é‡æ–°è®¾ç½®ä¸€ä¸ªè·¯ç”±çŠ¶æ€dashboardï¼Œè®¾ä¸ºçˆ¶è·¯ç”±ï¼ŒtemplateUrl:é“¾æ¥è‡³home.html,ç„¶åé¡µé¢ä¸­topnavbar.htmlå’ŒsideNavbar.htmlä»¥ng-includeçš„æ–¹å¼å¼•å…¥ï¼Œä¸­é—´å˜åŒ–çš„å†…å®¹æˆ‘è®¾æˆ  <div ui-view="content"></div>,Home.htmlå†…å®¹å¦‚ä¸‹ï¼š

```html
<div id="wrapper">
  <div ng-include="'app/layouts/navbar/topnavbar.html'"></div> 
  <div class="sideNavbar" ng-include="'app/layouts/navbar/sideNavbar.html'"></div>
  <div id="page-wrapper" class="white-bg {{$state.current.name}}">
    <div class="wrapper-content loading-wrapper">
      <div ui-view="content"></div>
      <div loading data="loading"></div>
    </div>
    <div ng-include="'app/layouts/navbar/footer.html'"></div>
  </div>
</div>
```

æ¥ä¸‹æ¥æ¯ä¸ªä¾§è¾¹æ è·¯ç”±çš„é…ç½®éƒ½åœ¨ç›¸åº”çš„è·¯ç”±æ–‡ä»¶å¤¹ä¸‹ï¼Œä¾‹å¦‚è´¦æˆ·ç®¡ç†é¡µæ˜¯æ€ä¹ˆåµŒå…¥contentçš„

```javascript
            .state('accountManage', {
                parent: 'dashboard',
                url: '/accountManage',
                data: {
                    authorities: ['ROLE_USER', 'ROLE_ADMIN']
                },
                views: {
                    'content': {
                        templateUrl: 'app/main/accountManage/profileDisplay.html',
                        controller: 'fullUserinfoController'
                    }
                },
                resolve: {
                    loadPlugin: function ($ocLazyLoad) {
                        return $ocLazyLoad.load([
                            {
                                serie: true,
                                name: 'ngFileUpload',
                                files: ['app/main/accountManage/accountManage.css','plugins/blueimp/jquery.blueimp-gallery.min.js','content/blueimp/css/blueimp-gallery.css','bower_components/ng-file-upload/ng-file-upload-shim.js','bower_components/ng-file-upload/ng-file-upload.js','app/main/accountManage/commitUserAudit.service.js','app/main/accountManage/fullUserinfo.controller.js']
                            }
                        ]);
                    },
                    translatePartialLoader: ['$translate', '$translatePartialLoader', function ($translate, $translatePartialLoader) {
   $translatePartialLoader.addPart('accountManage/userProfile');
                        return $translate.refresh();
                    }]
                }
            })
```

ğŸ’æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹è·¯ç”±ä¼ å‚ï¼Œé€šå¸¸å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¸‹ä¸€ä¸ªè·¯ç”±é¡µé¢ç”¨åˆ°ä¸Šä¸€ä¸ªè·¯ç”±é¡µé¢ä¼ è¿‡æ¥çš„å‚æ•°ï¼Œæ¯”å¦‚ä¸›æ•°æ®åˆ—è¡¨é¡µåˆ°æŸ¥çœ‹æŸæ¡æ•°æ®è¯¦æƒ…é¡µï¼Œéœ€è¦ä¼ è¯¥æ¡æ•°æ®çš„idè¿‡å»ï¼Œå¯é€šè¿‡è·¯ç”±ä¼ å‚

ä¾‹å¦‚æŸ¥çœ‹ç”¨æˆ·è®¤è¯ä¿¡æ¯è¯¦æƒ…ï¼š

htmlä»£ç 

```html
<button class="btn btn-sm btn-primary" 
  ui-sref="userAuditDetail({id:checkstatus.id})">{{'table.viewDetail' | translate}} </button>
```

æ³¨è§£

è·¯ç”±jsä»£ç 

```javascript
          .state('userAuditDetail', {
            parent: 'dashboard',
            url: '/userAuditDetail/:id',
            cache:true,
            data: {
                authorities: ['ROLE_ADMIN'],
                pageTitle: 'userAuditDetail'
            },
            views: {
                'content': {
                    templateUrl: 'app/main/auditInfo/userDetailInfo/userDetailInfo.html',
                    controller: 'userAuditDetailController',
                   controllerAs: 'vm'
                }
            },
            resolve: {
                   loadPlugin: function($ocLazyLoad) {
                    return $ocLazyLoad.load([{
                        serie: true,
                        files: ['plugins/blueimp/jquery.blueimp-gallery.min.js','content/blueimp/css/blueimp-gallery.css','app/main/auditInfo/userDetailInfo/userAuditDetail.service.js','app/main/auditInfo/userDetailInfo/updateUserAudit.service.js','app/main/auditInfo/userDetailInfo/userDetailInfo.controller.js']
                    }])
                },
                translatePartialLoader: ['$translate', '$translatePartialLoader', function ($translate, $translatePartialLoader) {
 $translatePartialLoader.addPart('accountManage/userProfile');
                    return $translate.refresh();
                }]
            }
        })
```

æ§åˆ¶å™¨

```
å› ä¸ºéœ€è¦ä¼ æ¥çš„idä½œä¸ºå¦ä¸€ä¸ªæœåŠ¡çš„å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦åœ¨æ§åˆ¶å™¨æ³¨å…¥$stateParamsï¼Œç„¶å$scope.thisId=$stateParams.id
ä»£ç å¦‚ä¸‹ï¼š
(function() {
	'use strict';

	angular
		.module('ejt1GatewayApp')
		.controller('userAuditDetailController', userAuditDetailController);
	userAuditDetailController.$inject = ['$scope','$log','$rootScope', '$stateParams', '$state', 'userAuditDetail', 'UserAudit'];

	function userAuditDetailController($scope,$log,$rootScope, $stateParams, $state, userAuditDetail, UserAudit) {
		var vm = this;
		vm.load = load;
		$scope.userAuditInfo = {};
		vm.load($stateParams.id); //è·¯ç”±å‚æ•°id
		function load(id) {
			userAuditDetail.get({ id: id }, function(result) {
				$log.debug(id);
				$scope.userAuditInfo = result;
}
})();

```

å…³äºè·¯ç”±ä¼ å‚ï¼Œæœ‰æ—¶æ ¹æ®éœ€æ±‚ï¼Œå¦ä¸€ä¸ªé¡µé¢éœ€è¦çš„ä¸åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæœ‰å¤šä¸ªå‚æ•°ï¼Œè·¯ç”±å¯ä»¥ä¼ å¯¹è±¡ï¼Œå…·ä½“çš„ç”¨æ³•è§é¡¹ç›®ï¼Œå¤šå¤„ç”¨åˆ°äº†ï¼Œå…·ä½“æ€è·¯æ˜¯å°†æ‰€éœ€è¦çš„å‚æ•°å˜é‡ç°’æˆä¸€ä¸ªå¯¹è±¡ï¼Œ

```
$scope.routeParmas={"parma1":"test1","parma2":"test2"}
$state.go('nextRoute',{routeParma:JSON.stringify($scope.routeParmas)})
routeParmaæ˜¯é€šè¿‡è·¯ç”±ä¼ å‚çš„åç§°
åœ¨ä¸‹ä¸€ä¸ªé¡µé¢æ§åˆ¶å™¨å¦‚ä½•è·å–ä¼ è¿‡æ¥çš„å¯¹è±¡ï¼Ÿ
  $scope.getRouteParma=angular.fromJson($stateParams.routeParma);
```

